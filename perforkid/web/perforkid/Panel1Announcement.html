<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Annoucement Page</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="Icon" href="./picture/Logo_1.jpg">
  <link rel="stylesheet" href="./style/Styling.css">
  <style>
    .dropdown-menu {
      display: none;
      position: absolute;
      right: 0;
    }
  
    .show {
      display: block;
    }
  </style>
  
</head>

<script>
  // Create a new XMLHttpRequest object
  const xhr = new XMLHttpRequest();

  // Configure it to fetch your CSS file
  xhr.open('GET', './style/Styling.css', true);
  xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 && xhr.status === 200) {
      // Create a style tag
      const style = document.createElement('style');
      style.textContent = xhr.responseText;

      // Append the style tag to the document head
      document.head.appendChild(style);
    }
  };

  // Send the request
  xhr.send();

</script>

<body>
  <div class="container-fluid">
    <!-- SIDEBAR SUPPORT SECTION, COPY PASTE THIS TO OTHER FILES -->
    <div class="row" style="min-height: 100vh;">
      <div class="col-3 bg-dark" style="height: 100%;">
        <div id="sidebar-container"></div>
        <script src="./module/manage/LoadSideBar.js" type="module" defer></script>
      </div>

      <!-- END OF SIDEBAR SUPPORT SECTION -->

      <!--  ========================================================= -->
      <!-- END OF ANNOUNCEMENT EDIT -->

      <div class="col-9 p-5 bg-light">
        <!-- ========================================================= -->
        <!-- START OF ANNOUNCEMENT EDIT SECTION -->
        <div class="row">
          <div id="editOverlay" style="display: none;">
            <form id="announcementFormEdit">
              <div class="container-fluid row">
                <div class="row">
                  <div class="col-8">
                    <h1 id="announcementEdith1"></h1>
                  </div>
                  <div class="col-4">
                    <label class="m-1" for="postTimestamp">
                      <h4>Posted Time</h4>
                    </label>
                    <input type="text" class="form-control-lg d-flex" id="postTimestampEdit" disabled>
                  </div>
                </div>

                <div class="divider"></div>
                <div class="col-sm-8 px-5">
                  <div class="form-group row">
                    <label class="m-1" for="postHeaderEdit">
                      <h4>หัวข้อใหม่</h4>
                    </label>
                    <input type="text" class="form-control-lg d-flex" id="postHeaderEdit" required>
                  </div>

                  <div class="form-group row mt-3">
                    <label class="m-1" for="postContentEdit">
                      <h4>เนื้อหาใหม่</h4>
                    </label>
                    <textarea class="form-control-lg d-flex" id="postContentEdit" rows="15" required></textarea>
                    <br>
                  </div>
                </div>

                <div class="col-sm-4">
                  <div class="form-group">
                    <label for="imageInputEdit">
                      <h4>อัพโหลดรูปภาพ</h4>
                    </label>
                    <input type="file" class="form-control d-flex m-1" id="imageInputEdit">
                    <div id="imagePreviewEdit" class="pt-4"></div>
                  </div>

                  <div class="form-group form-check form-switch mt-3">
                    <input class="form-check-input" type="checkbox" id="keepOldImage">
                    <label class="form-check-label m-1" for="keepOldImage">
                      <h5>ใช้รูปภาพเดิม</h5>
                    </label>
                  </div>
                </div>
                <div class="row m-4" style="float: none; margin: 0 auto;">
                  <script src="./module/manage/AnnouncementEdit.js" type="module"></script>
                  <button type="button" class="btn btn-success col-sm-5 d-flex m-3" id="submitEditBtn"
                    style=" justify-content: center; align-items: center;">
                    ยืนยันการแก้ไข &#10004;
                  </button>
                  <button type="button" class="btn btn-danger col-sm-5 d-flex m-3" id="cancelEditBtn"
                    style=" justify-content: center; align-items: center;">
                    ยกเลิกการแก้ไข &#x2718;
                  </button>
                </div>

            </form>

            <script>
              document.getElementById('imageInputEdit').addEventListener('change', function () {
                const file = this.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                  const preview = document.getElementById('imagePreviewEdit');
                  const img = new Image();
                  img.src = e.target.result;
                  img.className = 'img-fluid';
                  preview.innerHTML = '';
                  preview.appendChild(img);
                }

                reader.readAsDataURL(file);
              });

              document.getElementById('announcementFormEdit').addEventListener('reset', function () {
                const preview = document.getElementById('imagePreviewEdit');
                preview.innerHTML = '';
              });
            </script>

            <script src="./module/manage/AnnouncementEdit.js" type="module"></script>
          </div>
          <div class="divider"></div>
        </div>
        <div class="row">
          <div class="col-8">
            <h1>Announcement Page</h1>
          </div>
          <div class="col-4">
            <!-- <button type="button" class="btn btn-success d-flex" id="addPostStartBtn" style="float: none; margin: 0 auto;">+ เพิ่มโพสต์ใหม่</button> -->

            <!-- here -->
            <div class="mt-3 d-flex justify-content-end">
              <div class="dropdown">
                <span id="ellipsis" style="cursor: pointer;" onclick="showBtn()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
                  </svg>
                </span>
                
                <ul id="addPostMenu" class="dropdown-menu dropdown-menu-end">
                  <li><button type="button" class="dropdown-item" id="addPostStartBtn">+ เพิ่มโพสต์ใหม่</button></li>
                </ul>
              </div>
            
              <script>
                var isDropdownOpen = false;

                // Update the showBtn function to close the dropdown when an item is clicked
                function showBtn() {
                  var addPostMenu = document.getElementById("addPostMenu");
                  addPostMenu.classList.toggle("show");
                  isDropdownOpen = !isDropdownOpen;
                }

                // Add a click event listener to each dropdown item
                const dropdownItems = document.querySelectorAll("#addPostMenu .dropdown-item");
                dropdownItems.forEach(item => {
                  item.addEventListener("click", () => {
                    // Close the dropdown when an item is clicked
                    var addPostMenu = document.getElementById("addPostMenu");
                     addPostMenu.classList.remove("show");
                    isDropdownOpen = false;
                  });
                });
              </script>
            </div>
                    
          </div>
        </div>


        <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>
        <script type="module">
          // Initialize Firebase
          import * as FirebaseAPI from "../../firebaseConfig/FirebaseAPI.js";
          firebase.initializeApp(FirebaseAPI.firebaseConfig);
          import currentUser from './module/user/currentUser.js';
          import { submitAnnouncement } from './module/manage/AnnouncementSubmit.js';

          const storedUser = sessionStorage.getItem('currentUser');

          if (storedUser) {
            // แปลง JSON ที่ถูกเก็บไว้ใน sessionStorage กลับเป็น Object
            const storedCurrentUser = JSON.parse(storedUser);

            // ตั้งค่าค่า email และ school_name จาก storedCurrentUser
            currentUser.email = storedCurrentUser.email;
            currentUser.school_name = storedCurrentUser.school_name;
            currentUser.loggedin = storedCurrentUser.loggedin;
            currentUser.role = storedCurrentUser.role;
          }

          if (currentUser.loggedin == 'no') {
            window.location.href = "./AdminLanding.html";
          }


          const schoolTextElement = document.getElementById('schoolText');
          schoolTextElement.innerHTML = `โพสต์ทั้งหมดของ : <b>${currentUser.school_name}</b>`;

        </script>

        <div class="divider"></div>
        <script src="./module/user/userDataKeeper.js" type="module"></script>

        <!-- Add this in your HTML file -->
        <div class="row">
          <div id="addOverlay" style="display: none;">
            <form id="announcementFormAdd">
              <div class="container-fluid row">
                <div class="col-sm-8 px-5">
                  <div class="form-group row">
                    <label class="m-1" for="postHeader">
                      <h4>หัวข้อ</h4>
                    </label>
                    <input type="text" class="form-control-lg d-flex" id="postHeaderAdd" required>
                  </div>

                  <div class="form-group row mt-3">
                    <label class="m-1" for="postContentAdd">
                      <h4>เนื้อหา</h4>
                    </label>
                    <textarea class="form-control-lg d-flex" id="postContentAdd" rows="5" required></textarea>
                    <br>
                  </div>

                </div>

                <div class="col-sm-4">
                  <div class="form-group row">
                    <label class="m-1" for="imageInputAdd">
                      <h4>อัพโหลดรูปภาพ</h4>
                    </label>
                    <input type="file" class="form-control d-flex" id="imageInputAdd" accept=".jpg, .jpeg, .png"
                      multiple>
                    <div id="imagePreviewAdd"></div>
                  </div>

                </div>



                <div class="row m-4" style="float: none; margin: 0 auto;">
                  <script src="./module/manage/AnnouncementSubmit.js" type="module"></script>
                  <button type="button" class="btn btn-success col-sm-5 d-flex m-3" id="submitAddBtn"
                    style=" justify-content: center; align-items: center;">
                    เพิ่มโพสต์ &#10004;
                  </button>
                  <button type="button" class="btn btn-danger col-sm-5 d-flex m-3" id="cancelAddBtn"
                    style=" justify-content: center; align-items: center;">
                    ยกเลิก &#10008;
                  </button>
                </div>

                <div class="divider mb-5"></div>
            </form>

            <script>
              document.getElementById('imageInputAdd').addEventListener('change', function () {
                const file = this.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                  const preview = document.getElementById('imagePreviewAdd');
                  const img = new Image();
                  img.src = e.target.result;
                  img.className = 'img-fluid';
                  preview.innerHTML = '';
                  preview.appendChild(img);
                }

                reader.readAsDataURL(file);
              });
              document.getElementById('announcementFormAdd').addEventListener('reset', function () {
                const preview = document.getElementById('imagePreviewAdd');
                preview.innerHTML = '';
              });
            </script>

            <br>

          </div>
        </div>


        <h3 id="schoolText"></h3>

        <ul id="fileList"></ul>

        <div id="announcementContainer"></div>
        <script src="./module/show/ShowAnnouncementPost.js" type="module"></script>

      </div>
    </div>
  </div>

</body>

</html>